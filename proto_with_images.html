<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a3a4a">
  <title>President Maker - Vote Counting Simulator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- ===== 보드게임 개표 헬퍼 웹앱 (이미지 기반) ===== -->
<div id="election-helper">

  <!-- 화면1: 핵심지지층 입력 -->
  <section id="screen1" class="eh-screen">
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-1">
        <img src="Resources/files/리소스/1단계_핵심지지층/new_background.png" class="panel-bg" alt="panel">

        <div class="notice-header">
          <img src="Resources/files/리소스/1단계_핵심지지층/Title_icon.png" class="title-icon" alt="icon">
          <div class="notice-text">
            <h2>Please <span class="highlight">enter</span> the number of core supporters</h2>
            <p class="hint"><img src="Resources/files/리소스/1단계_핵심지지층/Red_icon.png" class="hint-icon" alt="star"> Please indicate if minor candidates have unified</p>
          </div>
        </div>

        <div class="candidates-input">
          <!-- Orange -->
          <div class="candidate-row" data-cand="A">
            <img src="Resources/files/리소스/1단계_핵심지지층/Orange_logo.png" class="cand-logo" alt="orange">
            <div class="bar-container">
              <div class="eh-bar" data-key="A" data-min="1" data-max="9">
                <div class="bar-images"></div>
              </div>
            </div>
            <button class="unify-btn" data-cand="A" aria-pressed="false">
              <img src="Resources/files/리소스/1단계_핵심지지층/Red_icon.png" alt="unify">
            </button>
          </div>

          <!-- Purple -->
          <div class="candidate-row" data-cand="B">
            <img src="Resources/files/리소스/1단계_핵심지지층/Purple_logo.png" class="cand-logo" alt="purple">
            <div class="bar-container">
              <div class="eh-bar" data-key="B" data-min="1" data-max="9">
                <div class="bar-images"></div>
              </div>
            </div>
            <button class="unify-btn" data-cand="B" aria-pressed="false">
              <img src="Resources/files/리소스/1단계_핵심지지층/Red_icon.png" alt="unify">
            </button>
          </div>

          <!-- Green -->
          <div class="candidate-row" data-cand="C">
            <img src="Resources/files/리소스/1단계_핵심지지층/Green_logo.png" class="cand-logo" alt="green">
            <div class="bar-container">
              <div class="eh-bar" data-key="C" data-min="1" data-max="9">
                <div class="bar-images"></div>
              </div>
            </div>
            <button class="unify-btn" data-cand="C" aria-pressed="false">
              <img src="Resources/files/리소스/1단계_핵심지지층/Red_icon.png" alt="unify">
            </button>
          </div>

          <!-- White -->
          <div class="candidate-row" data-cand="D">
            <img src="Resources/files/리소스/1단계_핵심지지층/White_logo.png" class="cand-logo" alt="white">
            <div class="bar-container">
              <div class="eh-bar" data-key="D" data-min="1" data-max="9">
                <div class="bar-images"></div>
              </div>
            </div>
            <button class="unify-btn" data-cand="D" aria-pressed="false">
              <img src="Resources/files/리소스/1단계_핵심지지층/Red_icon.png" alt="unify">
            </button>
          </div>
        </div>

        <button id="to2" class="transparent-next-btn"></button>
      </div>
    </div>
  </section>

  <!-- 화면2: 지역 선택 -->
  <section id="screen2" class="eh-screen" hidden>
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-2">
        <img src="Resources/files/리소스/2단계_지역선택/new_background.png" class="panel-bg" alt="panel">

        <div class="notice-header">
          <img src="Resources/files/리소스/1단계_핵심지지층/Title_icon.png" class="title-icon" alt="icon">
          <div class="notice-text">
            <h2>Please select a region for vote counting</h2>
            <p class="hint">Seoul/Gyeonggi region is counted last</p>
          </div>
        </div>

        <div class="region-selection">
          <div class="left-section">
            <div class="progress-board">
              <img id="notice-bg-image" src="Resources/files/리소스/2단계_지역선택/new_notice1.png" class="notice-bg" alt="background">
              <img id="board-bg-image" src="Resources/files/리소스/2단계_지역선택/Board_background_1.png" class="board-bg" alt="board">
            </div>
            <div id="round-instruction" class="round-instruction">Please select the region for position 1</div>
          </div>

          <div id="region-grid" class="region-grid">
            <!-- 지역 버튼들이 동적으로 추가됨 -->
          </div>
        </div>

        <!-- 화면2는 버튼이 없음 (지역 선택이 곧 다음 단계) -->
      </div>
    </div>
  </section>

  <!-- 화면3: 지역 지지도 입력 -->
  <section id="screen3" class="eh-screen" hidden>
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-3">
        <img src="Resources/files/리소스/3단계_지역수치입력/new_background1.png" class="panel-bg" id="screen3-bg" alt="panel">

        <!-- Notice 헤더 -->
        <div class="notice-header">
          <img src="Resources/files/리소스/1단계_핵심지지층/Title_icon.png" class="title-icon" alt="icon">
          <div class="notice-text">
            <h2>Please enter the <span class="highlight">engagement level</span> and <span class="highlight">supporter count</span> for the selected region</h2>
          </div>
        </div>

        <!-- 메인 콘텐츠 영역 -->
        <div class="screen3-content">
          <!-- 왼쪽: 지역 정보 -->
          <div class="region-info-box">
            <img src="Resources/files/리소스/3단계_지역수치입력/Notice_background.png" class="region-notice-bg" alt="background">
            <img id="region-image" src="" alt="region" class="region-img-3">
          </div>

          <!-- 오른쪽: 입력 영역 -->
          <div class="input-area-wrapper">
            <div class="inputs-container">
              <!-- 관심도 -->
              <div class="input-row interest-row">
                <div class="grid-cells-wrapper" id="interest-bar" data-key="interest" data-min="8" data-max="14"></div>
              </div>

              <!-- 주황 -->
              <div class="input-row support-row">
                <div class="grid-cells-wrapper support-bar" data-key="rA" data-min="0" data-max="7" data-color="Orange"></div>
              </div>

              <!-- 보라 -->
              <div class="input-row support-row">
                <div class="grid-cells-wrapper support-bar" data-key="rB" data-min="0" data-max="7" data-color="Purple"></div>
              </div>

              <!-- 초록 -->
              <div class="input-row support-row">
                <div class="grid-cells-wrapper support-bar" data-key="rC" data-min="0" data-max="7" data-color="Green"></div>
              </div>

              <!-- 흰색 -->
              <div class="input-row support-row">
                <div class="grid-cells-wrapper support-bar" data-key="rD" data-min="0" data-max="7" data-color="White"></div>
              </div>
            </div>
          </div>
        </div>

        <button id="to4" class="transparent-next-btn"></button>
      </div>
    </div>
  </section>

  <!-- 화면4: 개표 -->
  <section id="screen4" class="eh-screen" hidden>
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-4">
        <img src="Resources/files/리소스/4단계_지역 개표/new_background.png" class="panel-bg panel-4-bg" alt="panel">

        <div class="notice-header">
          <img src="Resources/files/리소스/1단계_핵심지지층/Title_icon.png" class="title-icon" alt="icon">
          <div class="notice-text">
            <h2>Vote counting in progress!</h2>
          </div>
        </div>

        <div class="counting-area">
          <div class="bag-section">
            <img id="region-box" src="" alt="region bag" class="region-box">
          </div>

          <!-- 중앙 애니메이션 영역 -->
          <div id="card-animation-area" class="card-animation-area"></div>

          <div class="draw-actions">
            <button id="draw1" class="draw-btn">
              <img src="Resources/files/리소스/4단계_지역 개표/Button.png" alt="count votes">
            </button>
            <div class="remain-info">
              Remaining draws <b id="remain-draws">0</b>/<span id="total-draws">0</span>
            </div>
            <div id="bag-remain-display" class="bag-remain-display"></div>
          </div>
        </div>

        <!-- 득표 미플들 (절대 위치) -->
        <div class="tally-meeples-container">
          <img id="meeple-A" class="tally-meeple-absolute" src="Resources/files/리소스/1단계_핵심지지층/Orange_meeple.png" alt="orange meeple">
          <img id="meeple-B" class="tally-meeple-absolute" src="Resources/files/리소스/1단계_핵심지지층/Purple_meeple.png" alt="purple meeple">
          <img id="meeple-C" class="tally-meeple-absolute" src="Resources/files/리소스/1단계_핵심지지층/Green_meeple.png" alt="green meeple">
          <img id="meeple-D" class="tally-meeple-absolute" src="Resources/files/리소스/1단계_핵심지지층/White_meeple.png" alt="white meeple">
        </div>

        <div id="log-container" class="log-area" style="display:none;">
          <div id="region-log"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- 화면5: 최종 결과 -->
  <section id="screen5" class="eh-screen" hidden>
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-5">
        <img id="winner-bg" src="" class="panel-bg" alt="panel">

        <button id="view-stats" class="transparent-stats-btn"></button>
      </div>
    </div>
  </section>

  <!-- 화면6: 통계 -->
  <section id="screen6" class="eh-screen" hidden>
    <div class="screen-container">
      <img src="Resources/files/리소스/1단계_핵심지지층/Background.png" class="bg-image" alt="background">

      <div class="main-panel panel-6">
        <img id="stats-bg" src="" class="panel-bg" alt="panel">

        <div class="stats-content">
          <!-- 서울경기 -->
          <div class="region-stats seoul-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>

          <!-- 강원 -->
          <div class="region-stats gangwon-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>

          <!-- 충청 -->
          <div class="region-stats chungcheong-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>

          <!-- 경상 -->
          <div class="region-stats gyeongsang-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>

          <!-- 전라 -->
          <div class="region-stats jeolla-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>

          <!-- 전국 -->
          <div class="region-stats national-stats">
            <div class="stat-card rank1"></div>
            <div class="stat-card rank2"></div>
            <div class="stat-card rank3"></div>
            <div class="stat-card rank4"></div>
            <div class="region-turnout"></div>
          </div>
        </div>

        <button id="back-to-result" class="transparent-back-btn"></button>
      </div>
    </div>
  </section>

</div>

<style>
  /* ===== 폰트 설정 ===== */
  @font-face {
    font-family: 'GmarketSans';
    src: url('Resources/fonts/GmarketSansTTFMedium.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }

  /* ===== 기본 설정 ===== */
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --panel-padding: 45px;
    --border-radius-sm: 8px;
    --border-radius-md: 12px;
    --border-radius-lg: 20px;
    --scale: 1;
  }

  html, body {
    overflow-x: hidden;
    overflow-y: auto;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #1a3a4a;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  #election-helper {
    width: 100%;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  /* ===== 화면 공통 ===== */
  .eh-screen {
    width: 100%;
    min-height: 100vh;
    position: absolute;
    top: 0;
    left: 0;
  }

  .screen-container {
    width: 100%;
    min-height: 100vh;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px 0;
    box-sizing: border-box;
    overflow: visible;
  }

  .bg-image {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
    pointer-events: none;
  }

  .main-panel {
    position: relative;
    z-index: 1;
    background: transparent;
    border-radius: 20px;
    padding: 0;
    width: 1594px;
    height: 1145px;
    box-shadow: 0 10px 50px rgba(0,0,0,0.3);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transform: scale(var(--scale, 1));
    transform-origin: center;
    flex-shrink: 0;
    /* scale 적용 시 레이아웃 공간 조정 */
    margin: calc((1145px * (var(--scale, 1) - 1)) / 2) auto;
  }

  .panel-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: var(--border-radius-lg);
    z-index: -1;
    pointer-events: none;
    object-fit: fill;
  }

  .panel-4 {
    padding: 35px;
  }

  .panel-inner-bg {
    position: absolute;
    top: 15%;
    left: 2.4%;
    width: 95%;
    height: 82%;
    object-fit: cover;
    /* border-radius: 12px; */
    z-index: 1;
    pointer-events: none;
  }

  .panel-4 > *:not(.panel-bg):not(.panel-inner-bg) {
    position: relative;
    z-index: 2;
  }

  .panel-4 .notice-header {
    flex-shrink: 0;
    padding: 12px 40px 8px;
    margin-bottom: 0;
  }

  .panel-4 .title-icon {
    width: 50px;
  }

  .panel-4 .notice-text h2 {
    font-size: 20px;
  }

  /* ===== 헤더 ===== */
  .notice-header {
    display: none;
    align-items: flex-end;
    justify-content: flex-start;
    gap: 15px;
    padding: 25px 60px 20px;
    background: transparent;
    border-radius: var(--border-radius-md);
    flex-shrink: 0;
  }

  .title-icon {
    width: 70px;
    height: auto;
    flex-shrink: 0;
    object-fit: contain;
  }

  .notice-text h2 {
    font-size: 26px;
    font-weight: 700;
    color: #1a3a4a;
    margin-bottom: 6px;
    line-height: 1.35;
  }

  .notice-text .hint {
    font-size: 15px;
    color: #5f7a8a;
    line-height: 1.5;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .hint-icon {
    width: 22px;
    height: 22px;
    object-fit: contain;
    flex-shrink: 0;
  }

  .notice-text .highlight {
    color: #1a3a4a;
    font-weight: 800;
  }

  .notice-text .highlight-orange {
    color: #f2994a;
    font-weight: 700;
  }

  /* ===== 화면1: 핵심지지층 ===== */
  .candidates-input {
    display: flex;
    flex-direction: column;
    gap: 18px;
    background: transparent;
    padding: 20px 80px;
    padding-top: 14.4%;
    border-radius: var(--border-radius-md);
    flex: 1;
    justify-content: center;
    align-items: center;
    min-height: 0;
  }

  .candidate-row {
    display: flex;
    gap: 42px;
    align-items: center;
  }

  .cand-logo {
    width: 143px;
    height: 143px;
    flex-shrink: 0;
    aspect-ratio: 1;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
  }

  .bar-container {
    position: relative;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    flex-shrink: 0;
  }

  .bar-images {
    display: flex;
    gap: 0;
    flex-wrap: nowrap;
    align-items: center;
    position: relative;
    height: 98px;
    border-radius: 0;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }

  .bar-segment {
    width: 98px;
    height: 98px;
    aspect-ratio: 1 / 1;
    cursor: pointer;
    position: relative;
    touch-action: manipulation;
    border: none;
    background: none;
    padding: 0;
    flex-shrink: 0;
  }

  .bar-segment:last-child {
    width: 98px;
    height: 98px;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    position: relative;
  }

  .bar-segment:last-child .bar-segment-bg {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
  }

  .bar-segment:disabled {
    cursor: default;
    pointer-events: none;
  }

  .bar-segment-bg {
    width: 100%;
    height: 100%;
    object-fit: fill;
    display: block;
  }

  .bar-meeple {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    height: 90%;
    object-fit: contain;
    pointer-events: none;
    z-index: 2;
  }

  .bar-number {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 45px;
    font-weight: 800;
    color: rgba(128, 128, 128, 0.5);
    pointer-events: none;
    z-index: 1;
  }

  .bar-segment:active {
    opacity: 0.9;
  }

  @media (hover: hover) {
    .bar-segment:hover {
      filter: brightness(1.1);
    }
  }

  .unify-btn {
    width: 105px;
    height: 105px;
    flex-shrink: 0;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: transform 0.2s, opacity 0.2s;
    touch-action: manipulation;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .unify-btn img {
    width: 100%;
    height: 100%;
    opacity: 0.4;
    user-select: none;
    transition: opacity 0.2s, filter 0.2s;
  }

  .unify-btn[aria-pressed="true"] img {
    opacity: 1;
    filter: drop-shadow(0 0 3px #ff3333);
  }

  .unify-btn:active {
    transform: scale(0.9);
  }

  @media (hover: hover) {
    .unify-btn:hover {
      transform: scale(1.1);
    }
  }


  /* ===== 버튼 공통 ===== */
  .next-btn, .back-btn, .restart-btn {
    cursor: pointer;
    border: none;
    background: transparent;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .next-btn-container {
    display: none;
    justify-content: flex-end;
    align-items: flex-end;
    padding: 15px 60px 25px;
    flex-shrink: 0;
  }

  .next-btn {
    position: relative;
    width: 160px;
  }

  /* 투명 다음 단계 버튼 (새 배경 이미지의 버튼 위에 오버레이) */
  .transparent-next-btn {
    position: absolute;
    right: 3%;
    bottom: 3%;
    width: 11%;
    height: 6%;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .transparent-next-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .transparent-next-btn:hover {
      transform: scale(1.05);
    }
  }

  .next-btn img {
    width: 100%;
    height: auto;
    display: block;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
  }

  .next-btn-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 22px;
    font-weight: 800;
    color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    pointer-events: none;
    letter-spacing: -0.02em;
    white-space: nowrap;
  }

  .next-btn:active, .back-btn:active, .restart-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .next-btn:hover, .back-btn:hover, .restart-btn:hover {
      transform: scale(1.05);
    }
  }

  .back-btn {
    padding: 12px 30px;
    background: #94b8ff;
    border-radius: var(--border-radius-sm);
    color: white;
    font-weight: 700;
    font-size: 16px;
  }

  /* ===== 화면2: 지역 선택 ===== */
  .region-selection {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    padding: 20px 60px;
    padding-top: 10%;
    flex: 1;
    align-items: center;
    min-height: 0;
    transform: translateX(-3.14%);
  }

  .left-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
    transform: translateX(0.63%);
  }

  .progress-board {
    position: relative;
    width: 100%;
    max-width: 550px;
  }

  .notice-bg {
    width: 100%;
    height: auto;
    display: block;
  }

  .board-bg {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 75%;
    height: auto;
    z-index: 1;
  }

  .round-instruction {
    display: none;
    color: #f2994a;
    font-weight: 800;
    font-size: 22px;
    text-align: center;
    line-height: 1.4;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
    padding: 12px 25px;
    border-radius: var(--border-radius-sm);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }

  .region-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    align-content: center;
    justify-items: center;
  }

  .region-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: transform 0.2s, filter 0.3s;
    touch-action: manipulation;
    position: relative;
  }

  .region-btn img {
    width: 100%;
    height: auto;
    display: block;
  }

  .region-btn:active:not(:disabled) {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .region-btn:hover:not(.region-btn-disabled) {
      transform: scale(1.05);
    }
  }

  .region-btn.region-btn-disabled {
    opacity: 0.3;
    cursor: not-allowed;
    filter: grayscale(80%) brightness(0.6);
    pointer-events: none;
  }

  .region-btn.region-btn-done {
    opacity: 0.5;
    filter: grayscale(50%);
    pointer-events: none;
  }

  /* ===== 화면3: 지역 지지도 ===== */
  .screen3-content {
    display: grid;
    grid-template-columns: 240px 1fr;
    gap: 25px;
    padding: 20px 60px;
    flex: 1;
    align-items: stretch;
    overflow: hidden;
    min-height: 0;
  }

  /* 왼쪽: 지역 정보 박스 */
  .region-info-box {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px 20px;
    height: 100%;
  }

  .region-notice-bg {
    display: none;
  }

  .region-img-3 {
    display: none;
  }

  /* 오른쪽: 입력 영역 */
  .input-area-wrapper {
    position: relative;
    padding: 25px 0;
    padding-top: 20%;
    height: 90%;
    transform: translate(15.68%, 1.75%);
  }

  .inputs-container {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 0px;
    height: 100%;
    justify-content: space-evenly;
  }

  .input-row {
    display: flex;
    gap: 17px;
    align-items: center;
  }

  .interest-row {
    margin-bottom: 15px;
  }

  .interest-row .row-icon {
    width: 91px;
    height: 91px;
    object-fit: contain;
    flex-shrink: 0;
  }

  .grid-cells-wrapper {
    display: grid;
    grid-auto-flow: column;
    gap: 0;
    align-items: center;
  }

  .grid-cell {
    position: relative;
    width: 91px;
    height: 91px;
    cursor: pointer;
    transition: transform 0.2s, filter 0.2s;
    touch-action: manipulation;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .grid-cell img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    user-select: none;
  }

  .marker-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    height: 90%;
    object-fit: contain;
    pointer-events: none;
    z-index: 2;
  }

  .grid-number {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 36px;
    font-weight: 800;
    color: rgba(128, 128, 128, 0.5);
    pointer-events: none;
    z-index: 1;
  }

  .logo-cell {
    cursor: default !important;
    pointer-events: none !important;
  }

  .grid-cell:active {
    transform: scale(0.9);
  }

  @media (hover: hover) {
    .grid-cell:hover:not(.logo-cell) {
      transform: scale(1.1);
      filter: brightness(1.15) drop-shadow(0 0 5px rgba(255,255,255,0.5));
    }
  }

  .back-btn-3 {
    position: absolute;
    bottom: 2.62%;
    left: 3.76%;
    z-index: 10;
  }

  /* ===== 화면4: 개표 ===== */
  .counting-area {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 32px;
    margin-top: 292px;
    margin-bottom: 25px;
    padding: 22px 72px;
    background: transparent;
    border-radius: var(--border-radius-md);
    position: relative;
  }

  .card-animation-area {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 506px;
    height: 506px;
    pointer-events: none;
    z-index: 10;
  }

  .card-reveal {
    width: 100%;
    height: 100%;
    object-fit: contain;
    animation: cardReveal 1.2s ease-out forwards;
  }

  @keyframes cardReveal {
    0% {
      opacity: 0;
      transform: scale(0.3) rotate(-10deg);
    }
    50% {
      opacity: 1;
      transform: scale(1.15) rotate(5deg);
    }
    100% {
      opacity: 0.9;
      transform: scale(1) rotate(0deg);
    }
  }

  .bag-section {
    text-align: center;
  }

  .region-box {
    width: 396px;
    height: auto;
    aspect-ratio: 4/3;
    object-fit: contain;
    margin-bottom: 12px;
  }

  .remain-info {
    font-size: 27px;
    font-weight: 700;
    color: #1a3a4a;
    margin-bottom: 12px;
    text-align: right;
  }

  .bag-remain-display {
    display: flex;
    gap: 6px;
    justify-content: flex-end;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 6px;
    margin-right: -85px;
  }

  .bag-remain-item {
    display: flex;
    align-items: center;
    gap: 3px;
  }

  .bag-remain-item img {
    width: 42px;
    height: 42px;
    object-fit: contain;
  }

  .bag-remain-item .count {
    font-size: 27px;
    font-weight: 800;
    color: #1a3a4a;
    min-width: 27px;
    text-align: center;
  }

  .draw-actions {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .draw-btn {
    position: relative;
    border: none;
    background: transparent;
    cursor: pointer;
    transition: transform 0.2s;
    width: 375px;
    touch-action: manipulation;
  }

  .draw-btn img {
    width: 100%;
    height: auto;
  }

  .btn-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    font-weight: 800;
    color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    white-space: nowrap;
  }

  .draw-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .draw-btn:hover {
      transform: scale(1.05);
    }
  }

  /* 득표 미플 컨테이너 (절대 위치) */
  /* 배경 이미지의 득표 트랙 영역에 정확히 맞춤 */
  .tally-meeples-container {
    position: absolute;
    bottom: 7.5%;
    left: 6%;
    width: 88%;
    height: 32%;
    pointer-events: none;
    z-index: 5;
    /* 디버깅용: 컨테이너 영역 확인 (나중에 제거) */
    /* border: 2px dashed red; */
  }

  .tally-meeple-absolute {
    position: absolute;
    width: 3%;
    height: auto;
    aspect-ratio: 1 / 1;
    object-fit: contain;
    transition: left 0.3s ease;
    pointer-events: none;
  }

  /* 각 미플의 초기 위치 (컨테이너 기준) */
  #meeple-A {
    top: 22%;
    left: 1.5%;
  }

  #meeple-B {
    top: 39%;
    left: 1.5%;
  }

  #meeple-C {
    top: 56%;
    left: 1.5%;
  }

  #meeple-D {
    top: 73%;
    left: 1.5%;
  }

  .tally-bar-bg {
    height: 40px;
    background: rgba(200, 210, 220, 0.3);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
  }

  .tally-bar-fill {
    height: 100%;
    transition: width 0.5s ease;
    width: 0%;
  }

  .tally-bar-fill.orange { background: linear-gradient(90deg, #f2994a 0%, #f39c12 100%); }
  .tally-bar-fill.purple { background: linear-gradient(90deg, #9b59b6 0%, #8e44ad 100%); }
  .tally-bar-fill.green { background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%); }
  .tally-bar-fill.white { background: linear-gradient(90deg, #bdc3c7 0%, #95a5a6 100%); }

  .tally-value {
    text-align: center;
    font-size: 24px;
    font-weight: 800;
    color: #1a3a4a;
  }

  .log-area {
    margin-top: var(--spacing-md);
    max-height: 200px;
    overflow-y: auto;
    padding: 15px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: var(--border-radius-sm);
    font-family: 'Courier New', monospace;
    font-size: 13px;
  }

  /* ===== 화면5: 최종 결과 ===== */
  .panel-5 {
    padding: 45px;
  }

  .final-results {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 20px;
    padding: 0 20px;
  }

  .final-card {
    text-align: center;
    padding: 18px;
    background: white;
    border-radius: var(--border-radius-md);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .final-card img {
    width: 55px;
    height: 55px;
    margin-bottom: 8px;
  }

  .final-card .value {
    font-size: 32px;
    font-weight: 800;
    color: #1a3a4a;
  }

  .winner-announce {
    text-align: center;
    font-size: 28px;
    font-weight: 800;
    padding: 22px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: var(--border-radius-md);
    margin: 0 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    line-height: 1.3;
  }

  .final-buttons {
    display: flex;
    gap: 25px;
    justify-content: center;
    align-items: center;
  }

  .stats-btn,
  .restart-btn {
    padding: 15px 50px;
    border-radius: var(--border-radius-md);
    font-size: 20px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .stats-btn {
    background: #10b981;
    color: white;
  }

  .restart-btn {
    background: #2563eb;
    color: white;
  }

  .stats-btn:active,
  .restart-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .stats-btn:hover,
    .restart-btn:hover {
      transform: scale(1.05);
    }
  }

  /* ===== 화면5: 당선자 ===== */
  .transparent-stats-btn {
    position: absolute;
    right: 3%;
    bottom: 3%;
    width: 15%;
    height: 8%;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .transparent-stats-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .transparent-stats-btn:hover {
      transform: scale(1.05);
    }
  }

  /* ===== 화면6: 통계 ===== */
  .stats-content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .region-stats {
    position: absolute;
  }

  .stat-card {
    position: absolute;
    background: transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }

  /* 기본 배치 (가로 배열) */
  .stat-card.rank1 {
    top: 0;
    left: 0;
    width: 110px;
    height: 110px;
  }

  .stat-card.rank2 {
    top: 0;
    left: 118px;
    width: 70px;
    height: 70px;
  }

  .stat-card.rank3 {
    top: 0;
    left: 196px;
    width: 70px;
    height: 70px;
  }

  .stat-card.rank4 {
    top: 0;
    left: 274px;
    width: 70px;
    height: 70px;
  }

  /* 전국은 더 크게 */
  .national-stats .stat-card.rank1 {
    width: 180px;
    height: 180px;
  }

  .national-stats .stat-card.rank2 {
    width: 100px;
    height: 100px;
  }

  .national-stats .stat-card.rank3 {
    width: 100px;
    height: 100px;
  }

  .national-stats .stat-card.rank4 {
    width: 100px;
    height: 100px;
  }

  /* 각 지역별 개별 칸 위치 조정 */
  .seoul-stats .rank1 { top: 1px; left: 4px; }
  .seoul-stats .rank2 { top: 9px; left: 124px; }
  .seoul-stats .rank3 { top: 9px; left: 192px; }
  .seoul-stats .rank4 { top: 9px; left: 262px; }

  .gangwon-stats .rank1 { top: 4px; left: 3px; }
  .gangwon-stats .rank2 { top: 10px; left: 122px; }
  .gangwon-stats .rank3 { top: 11px; left: 192px; }
  .gangwon-stats .rank4 { top: 11px; left: 261px; }

  .chungcheong-stats .rank1 { top: 0px; left: 1px; }
  .chungcheong-stats .rank2 { top: 7px; left: 123px; }
  .chungcheong-stats .rank3 { top: 7px; left: 192px; }
  .chungcheong-stats .rank4 { top: 7px; left: 260px; }

  .gyeongsang-stats .rank1 { top: 1px; left: 5px; }
  .gyeongsang-stats .rank2 { top: 9px; left: 126px; }
  .gyeongsang-stats .rank3 { top: 8px; left: 195px; }
  .gyeongsang-stats .rank4 { top: 9px; left: 263px; }

  .jeolla-stats .rank2 { top: 9px; left: 122px; }
  .jeolla-stats .rank3 { top: 10px; left: 190px; }
  .jeolla-stats .rank4 { top: 10px; left: 258px; }

  .national-stats .rank1 { top: 13px; left: -3px; }
  .national-stats .rank2 { top: 24px; left: 192px; }
  .national-stats .rank3 { top: 24px; left: 296px; }
  .national-stats .rank4 { top: 24px; left: 401px; }

  .stat-logo {
    width: 70%;
    height: auto;
    object-fit: contain;
  }

  .stat-card.rank1 .stat-logo {
    width: 75%;
  }

  .stat-votes {
    font-size: 18px;
    font-weight: 800;
    color: #1a3a4a;
    line-height: 1;
  }

  .stat-card.rank1 .stat-votes {
    font-size: 22px;
  }

  .stat-rate {
    font-size: 13px;
    font-weight: 700;
    color: #e53935;
    line-height: 1;
  }

  .stat-card.rank1 .stat-rate {
    font-size: 15px;
  }

  .region-turnout {
    position: absolute;
    color: white;
    font-size: 22px;
    font-weight: 700;
    font-family: 'GmarketSans', sans-serif;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    padding: 5px;
    bottom: 5px;
    right: 10px;
  }

  .national-stats .region-turnout {
    font-size: 36px;
  }

  .seoul-stats .region-turnout,
  .gangwon-stats .region-turnout,
  .chungcheong-stats .region-turnout,
  .gyeongsang-stats .region-turnout,
  .jeolla-stats .region-turnout {
    font-size: 26px;
  }

  /* 각 지역별 투표율 위치 */
  .seoul-stats .region-turnout { bottom: 22px; right: -368px; }
  .gangwon-stats .region-turnout { bottom: 22px; right: -363px; }
  .chungcheong-stats .region-turnout { bottom: 23px; right: -364px; }
  .gyeongsang-stats .region-turnout { bottom: 24px; right: -366px; }
  .jeolla-stats .region-turnout { bottom: 21px; right: -361px; }
  .national-stats .region-turnout { bottom: 17px; right: -463px; }

  /* 각 지역 위치 */
  .seoul-stats {
    top: 32.6%;
    left: 9.5%;
  }

  .gangwon-stats {
    top: 32.7%;
    left: 60.3%;
  }

  .chungcheong-stats {
    top: 56.9%;
    left: 16.2%;
  }

  .gyeongsang-stats {
    top: 55.0%;
    left: 73.7%;
  }

  .jeolla-stats {
    top: 81.2%;
    left: 8.5%;
  }

  .national-stats {
    top: 73.6%;
    left: 60.3%;
  }

  .transparent-back-btn {
    position: absolute;
    right: 3%;
    bottom: 3%;
    width: 11%;
    height: 6%;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 100;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .transparent-back-btn:active {
    transform: scale(0.95);
  }

  @media (hover: hover) {
    .transparent-back-btn:hover {
      transform: scale(1.05);
    }
  }

  /* ===== 반응형 미디어 쿼리 제거됨 ===== */
  /* scale 방식을 사용하므로 모든 레이아웃 미디어 쿼리 불필요 */

  /* ===== 스크롤바 스타일 ===== */
  .main-panel::-webkit-scrollbar,
  .bar-container::-webkit-scrollbar,
  .bar-grid::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .main-panel::-webkit-scrollbar-track,
  .bar-container::-webkit-scrollbar-track,
  .bar-grid::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 3px;
  }

  .main-panel::-webkit-scrollbar-thumb,
  .bar-container::-webkit-scrollbar-thumb,
  .bar-grid::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.3);
    border-radius: 3px;
  }

  /* ===== 인쇄 대응 ===== */
  @media print {
    .bg-image {
      display: none;
    }
    .main-panel {
      box-shadow: none;
      max-height: none;
    }
  }

  /* ===== 접근성 개선 ===== */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>

<script>
(function(){
  const root = document.getElementById('election-helper');
  const $ = (sel, el=root)=> el.querySelector(sel);
  const $$ = (sel, el=root)=> el.querySelectorAll(sel);

  const C = ['A','B','C','D'];
  const CAND_NAMES = {A:'진보', B:'보수', C:'중도', D:'무소속'};
  const REGIONS = ['전라','경상','강원','충청','서울경기'];
  const REGION_MAP = {
    '전라': 'Jeolla',
    '경상': 'Gyeongsang',
    '강원': 'Gangwon',
    '충청': 'Chungcheong',
    '서울경기': 'Seoul'
  };
  const RANGES = { '서울경기':{min:11,max:17}, 'default':{min:8,max:13} };

  const state = {
    coreSupport:{A:1,B:1,C:1,D:1},
    baseTally:{A:1,B:1,C:1,D:1},
    regionAcc:{A:0,B:0,C:0,D:0},
    tally:{A:1,B:1,C:1,D:1},
    unify:null,
    regionsDone:[],
    currentRegion:null,
    regionData:{},
    bagRemain:{A:0,B:0,C:0,D:0,E:0},
    drawsRemain:0,
    runoffMode:false,
    runoffCandidates:[],
    regionResults:{}, // 지역별 득표 결과
  };
  REGIONS.forEach(r=>{ state.regionData[r]={interest:0, support:{A:0,B:0,C:0,D:0}}; });

  function show(id){
    $$('.eh-screen').forEach(s=>s.hidden=true);
    $(id).hidden=false;
  }

  function recompute(){
    C.forEach(k=> state.tally[k] = (state.baseTally[k]|0) + (state.regionAcc[k]|0));
    updateTallyDisplay();
  }

  // 득표 미플 위치 업데이트
  function updateTallyDisplay() {
    C.forEach((k) => {
      const meeple = $(`#meeple-${k}`);
      if (!meeple) return;

      const tallyValue = state.tally[k];

      // 25칸 (0~24) 중 현재 득표수 위치로 이동
      // 컨테이너 내에서 상대적 위치 계산
      if (tallyValue >= 0 && tallyValue <= 24) {
        // 조정 가능한 값들 (브라우저 콘솔에서 window.meepleConfig로 실시간 변경 가능)
        const config = window.meepleConfig || { 간격: 3.3, 시작위치: 1.5 };
        const leftPosition = (tallyValue * config.간격) + config.시작위치;
        meeple.style.left = `${leftPosition}%`;
      }
    });
  }

  // 화면1: 핵심지지층 막대 구현 (2색 + 미플, 정사각형 칸)
  function buildCoreBar(candKey) {
    const barEl = $(`.candidate-row[data-cand="${candKey}"] .eh-bar`);
    const container = barEl.querySelector('.bar-images');
    container.innerHTML = '';

    const colorName = {A:'Orange',B:'Purple',C:'Green',D:'White'}[candKey];

    // 9개의 세그먼트 생성 (1~9)
    for(let i=1; i<=9; i++) {
      const seg = document.createElement('button');
      seg.className = 'bar-segment';
      seg.dataset.val = i;
      seg.type = 'button';

      // 배경 이미지 (_1과 _2 교차)
      const bgImg = document.createElement('img');
      const imgNum = (i % 2 === 0) ? 1 : 2;
      bgImg.className = 'bar-segment-bg';
      bgImg.src = `Resources/files/리소스/1단계_핵심지지층/${colorName}_${imgNum}.png`;
      seg.appendChild(bgImg);

      // 숫자 표시
      const numLabel = document.createElement('div');
      numLabel.className = 'bar-number';
      numLabel.textContent = i;
      seg.appendChild(numLabel);

      // 클릭 이벤트: 이 위치에 미플 표시
      seg.addEventListener('click', () => {
        // 기존 미플 제거
        container.querySelectorAll('.bar-meeple').forEach(m => m.remove());

        // 새 미플 추가
        const meeple = document.createElement('img');
        meeple.className = 'bar-meeple';
        meeple.src = `Resources/files/리소스/1단계_핵심지지층/${colorName}_meeple.png`;
        seg.appendChild(meeple);

        // 상태 업데이트
        state.coreSupport[candKey] = i;
        state.baseTally[candKey] = i;
        recompute();
      });

      container.appendChild(seg);
    }

    // 초기값 1으로 설정
    state.coreSupport[candKey] = 1;
    state.baseTally[candKey] = 1;
  }

  C.forEach(buildCoreBar);

  // 단일화 버튼 및 체크박스
  $$('.unify-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const cand = btn.dataset.cand;
      const pressed = btn.getAttribute('aria-pressed') === 'true';

      // 모든 버튼 초기화
      $$('.unify-btn').forEach(b => b.setAttribute('aria-pressed', 'false'));

      if (pressed) {
        state.unify = null;
      } else {
        btn.setAttribute('aria-pressed', 'true');
        state.unify = cand;
      }
    });
  });


  $('#to2').addEventListener('click', () => {
    if (!confirm('Proceed to the next step?')) {
      return;
    }
    C.forEach(k => state.baseTally[k] = state.coreSupport[k]|0);
    recompute();
    buildRegionButtons();
    show('#screen2');
  });

  // 화면2: 지역 선택
  function buildRegionButtons() {
    const container = $('#region-grid');
    container.innerHTML = '';

    const remaining = REGIONS.filter(r => !state.regionsDone.includes(r));
    const doneCount = state.regionsDone.filter(r => r !== '서울경기').length;

    const bgNum = Math.min(doneCount + 1, 5);

    // Notice 배경 이미지 업데이트 (new_notice1~5)
    const noticeBg = $('#notice-bg-image');
    if (noticeBg) {
      noticeBg.src = `Resources/files/리소스/2단계_지역선택/new_notice${bgNum}.png`;
    }

    // 보드 배경 이미지 업데이트 (1~5)
    const boardBgImage = $('#board-bg-image');
    if (boardBgImage) {
      boardBgImage.src = `Resources/files/리소스/2단계_지역선택/Board_background_${bgNum}.png`;
    }

    // 안내 텍스트 업데이트
    const instruction = $('#round-instruction');
    const othersLeft = remaining.some(x => x !== '서울경기');

    if (othersLeft) {
      instruction.textContent = `Please select the region for position ${doneCount + 1}`;
    } else {
      instruction.textContent = 'Please select the Seoul/Gyeonggi region';
    }

    // 지역 버튼 생성
    REGIONS.forEach(r => {
      const btn = document.createElement('button');
      btn.className = 'region-btn';

      const regionFile = REGION_MAP[r];
      const isSeoul = r === '서울경기';
      const done = state.regionsDone.includes(r);

      const img = document.createElement('img');

      // 개표 완료된 지역
      if (done) {
        img.src = `Resources/files/리소스/2단계_지역선택/${regionFile}_idle.png`;
        btn.classList.add('region-btn-done');
      }
      // 서울경기는 다른 지역이 남아있으면 비활성화
      else if (isSeoul && othersLeft) {
        img.src = `Resources/files/리소스/2단계_지역선택/${regionFile}_idle.png`;
        btn.classList.add('region-btn-disabled');
      }
      // 개표 가능한 지역 (선택 가능 = selected 이미지)
      else {
        img.src = `Resources/files/리소스/2단계_지역선택/${regionFile}_selected.png`;
        btn.addEventListener('click', () => {
          goRegion(r);
        });
      }

      btn.appendChild(img);
      container.appendChild(btn);
    });
  }

  function goRegion(region) {
    state.currentRegion = region;

    const regionFile = REGION_MAP[region];
    $('#region-image').src = `Resources/files/리소스/3단계_지역수치입력/${regionFile}.png`;

    // 패널 배경 이미지 업데이트 (지역별 매핑)
    const regionBgMap = {
      '전라': 4,
      '경상': 2,
      '강원': 1,
      '충청': 5,
      '서울경기': 3
    };
    const bgNum = regionBgMap[region] || 1;
    const panelBg = $('#screen3-bg');
    panelBg.src = `Resources/files/리소스/3단계_지역수치입력/new_background${bgNum}.png`;

    const rng = RANGES[region] || RANGES.default;
    const interestBar = $('#interest-bar');
    interestBar.dataset.min = rng.min;
    interestBar.dataset.max = rng.max;

    buildGridBar(interestBar, 'interest', 'Engagement');

    const supportBars = $$('.support-row .support-bar');
    supportBars.forEach((bar, idx) => {
      const candKey = ['rA', 'rB', 'rC', 'rD'][idx];
      const color = bar.dataset.color;
      buildGridBar(bar, candKey, color);
    });

    show('#screen3');
  }

  function buildGridBar(barEl, key, colorName) {
    barEl.innerHTML = '';

    const min = parseInt(barEl.dataset.min);
    const max = parseInt(barEl.dataset.max);
    const isSupport = key.startsWith('r');
    const isInterest = key === 'interest';

    // 첫 번째 칸: 로고 아이콘
    const logoCell = document.createElement('div');
    logoCell.className = 'grid-cell logo-cell';
    const logoImg = document.createElement('img');

    if (isInterest) {
      logoImg.src = `Resources/files/리소스/3단계_지역수치입력/Marker.png`;
    } else {
      logoImg.src = `Resources/files/리소스/1단계_핵심지지층/${colorName}_logo.png`;
    }

    logoCell.appendChild(logoImg);
    logoCell.style.cursor = 'default';
    logoCell.style.pointerEvents = 'none';
    barEl.appendChild(logoCell);

    // 나머지 칸들: 선택 가능한 큐브
    for(let i=min; i<=max; i++) {
      const cell = document.createElement('div');
      cell.className = 'grid-cell';
      cell.dataset.val = i;

      const img = document.createElement('img');

      // 인덱스 기반으로 번갈아가며 (첫 번째 칸은 항상 밝은색)
      const idx = i - min;
      const imgNum = (idx % 2 === 0) ? 1 : 2;

      if (isInterest) {
        img.src = `Resources/files/리소스/3단계_지역수치입력/Engagement_${imgNum}.png`;
      } else {
        img.src = `Resources/files/리소스/1단계_핵심지지층/${colorName}_${imgNum}.png`;
      }

      cell.appendChild(img);

      // 숫자 레이블 추가
      const numLabel = document.createElement('div');
      numLabel.className = 'grid-number';
      numLabel.textContent = i;
      cell.appendChild(numLabel);

      cell.addEventListener('click', () => {
        // 기존 마커/미플 제거
        barEl.querySelectorAll('.grid-cell').forEach(c => {
          const marker = c.querySelector('.marker-overlay');
          if (marker) marker.remove();
        });

        // 새 마커/미플 추가
        const marker = document.createElement('img');
        marker.className = 'marker-overlay';

        if (isInterest) {
          marker.src = `Resources/files/리소스/3단계_지역수치입력/Marker.png`;
        } else {
          marker.src = `Resources/files/리소스/1단계_핵심지지층/${colorName}_meeple.png`;
        }

        cell.appendChild(marker);

        if (isInterest) {
          state.regionData[state.currentRegion].interest = i;
        } else {
          const cand = key.substring(1);
          state.regionData[state.currentRegion].support[cand] = i;
        }
      });

      barEl.appendChild(cell);
    }
  }

  // 주머니 남은 표 업데이트
  function updateBagRemainDisplay() {
    const container = $('#bag-remain-display');
    container.innerHTML = '';

    const candidates = [
      { key: 'A', name: 'Orange', logo: 'Resources/files/리소스/1단계_핵심지지층/Orange_logo.png' },
      { key: 'B', name: 'Purple', logo: 'Resources/files/리소스/1단계_핵심지지층/Purple_logo.png' },
      { key: 'C', name: 'Green', logo: 'Resources/files/리소스/1단계_핵심지지층/Green_logo.png' },
      { key: 'D', name: 'White', logo: 'Resources/files/리소스/1단계_핵심지지층/White_logo.png' },
      { key: 'E', name: 'Red', logo: 'Resources/files/리소스/1단계_핵심지지층/Red_icon.png' }
    ];

    candidates.forEach(cand => {
      const count = state.bagRemain[cand.key] || 0;

      const item = document.createElement('div');
      item.className = 'bag-remain-item';

      const img = document.createElement('img');
      img.src = cand.logo;
      img.alt = cand.name;

      // E후보(군소) 아이콘은 22% 크기로 조정
      if (cand.key === 'E') {
        img.style.width = '22%';
        img.style.height = '22%';
      }

      const countSpan = document.createElement('span');
      countSpan.className = 'count';
      countSpan.textContent = count;

      item.appendChild(img);
      item.appendChild(countSpan);
      container.appendChild(item);
    });
  }

  // 화면4: 개표
  $('#to4').addEventListener('click', () => {
    const r = state.currentRegion;
    const d = state.regionData[r];

    // 관심도 마커 존재 확인
    const interestBar = $('#interest-bar');
    const interestMarker = interestBar.querySelector('.marker-overlay');
    if (!interestMarker) {
      alert('Please select the engagement level.');
      return;
    }

    // 모든 후보자의 지지도 미플 존재 확인
    const candidateNames = {
      'A': 'Orange',
      'B': 'Purple',
      'C': 'Green',
      'D': 'White'
    };

    const supportBars = $$('.support-row .support-bar');
    for (let i = 0; i < supportBars.length; i++) {
      const bar = supportBars[i];
      const meeple = bar.querySelector('.marker-overlay');
      if (!meeple) {
        const cand = ['A', 'B', 'C', 'D'][i];
        alert(`Please select the support level for the ${candidateNames[cand]} candidate.`);
        return;
      }
    }

    state.bagRemain = { A:d.support.A|0, B:d.support.B|0, C:d.support.C|0, D:d.support.D|0, E:1 };
    state.drawsRemain = d.interest;

    const regionFile = REGION_MAP[r];
    $('#region-box').src = `Resources/files/리소스/4단계_지역 개표/${regionFile}_Box.png`;
    $('#remain-draws').textContent = state.drawsRemain;
    $('#total-draws').textContent = state.drawsRemain;

    // 개표 버튼 초기화 (새 지역 개표를 위해)
    isAnimating = false;
    const drawBtn = $('#draw1');
    drawBtn.disabled = false;
    drawBtn.style.opacity = '1';

    // 주머니 남은 표 표시
    updateBagRemainDisplay();

    recompute();
    show('#screen4');
  });

  function pickOne() {
    const tot = Object.values(state.bagRemain).reduce((a,b)=>a+b, 0);
    if (tot <= 0) return null;

    let r = Math.floor(Math.random() * tot) + 1;
    for (const k of ['A','B','C','D','E']) {
      r -= state.bagRemain[k];
      if (r <= 0) return k;
    }
    return null;
  }

  function credit(k) {
    if (k === 'E') {
      if (state.unify) {
        state.regionAcc[state.unify] += 1;
        return `E→${CAND_NAMES[state.unify]}`;
      }
      return 'E(무효)';
    }
    state.regionAcc[k] += 1;
    return CAND_NAMES[k];
  }

  let isAnimating = false;

  function drawOnce() {
    if (state.drawsRemain <= 0 || isAnimating) return;

    isAnimating = true;
    const drawBtn = $('#draw1');
    drawBtn.disabled = true;
    drawBtn.style.opacity = '0.6';

    const picked = pickOne();

    if (state.runoffMode) {
      // 추가개표 모드
      if (picked) {
        state.bagRemain[picked] -= 1;
        showCardAnimation(picked);

        // 동점자의 표인지 확인 (E표 포함)
        let isRunoffCandidate = false;

        if (picked === 'E' && state.unify && state.runoffCandidates.includes(state.unify)) {
          // 단일화된 후보가 동점자
          state.regionAcc[state.unify] += 1;
          isRunoffCandidate = true;
        } else if (picked !== 'E' && state.runoffCandidates.includes(picked)) {
          // 동점자의 표
          state.regionAcc[picked] += 1;
          isRunoffCandidate = true;
        }
        // else: 동점자가 아닌 표는 무시 (트랙 진행 안 함)

        recompute();
        updateBagRemainDisplay();

        setTimeout(() => {
          isAnimating = false;

          if (isRunoffCandidate) {
            // 동점이 해소됨 - 개표 완료 버튼 표시
            state.runoffMode = false;
            state.runoffCandidates = [];

            // baseTally에 누적
            C.forEach(k => {
              state.baseTally[k] += state.regionAcc[k];
              state.regionAcc[k] = 0;
            });

            setTimeout(() => {
              showFinishButton([]);
            }, 350);
          } else {
            // 동점자가 아닌 표 - 계속 진행
            drawBtn.disabled = false;
            drawBtn.style.opacity = '1';
          }
        }, 1275);
      } else {
        // 주머니가 비었을 때 (이론상 발생 안 함)
        showCardAnimation(null);
        setTimeout(() => {
          isAnimating = false;
          drawBtn.disabled = false;
          drawBtn.style.opacity = '1';
        }, 1275);
      }
    } else {
      // 기존 개표 로직
      state.drawsRemain -= 1;

      if (picked) {
        state.bagRemain[picked] -= 1;

        // 카드 애니메이션 표시
        showCardAnimation(picked);

        credit(picked);
        recompute();
      } else {
        // 주머니가 비었지만 개표 횟수는 남은 경우 - 무효표
        showCardAnimation(null);
      }

      $('#remain-draws').textContent = state.drawsRemain;
      updateBagRemainDisplay();

      // 애니메이션 완료 후 버튼 다시 활성화
      setTimeout(() => {
        isAnimating = false;
        if (state.drawsRemain > 0) {
          drawBtn.disabled = false;
          drawBtn.style.opacity = '1';
        }
      }, 1275);

      if (state.drawsRemain === 0) {
        if (!state.regionsDone.includes(state.currentRegion)) {
          state.regionsDone.push(state.currentRegion);
        }

        // 지역별 득표 결과 저장 (통계용)
        if (!state.regionResults[state.currentRegion]) {
          state.regionResults[state.currentRegion] = {};
        }
        C.forEach(k => {
          state.regionResults[state.currentRegion][k] = state.regionAcc[k];
        });

        // 현재 지역의 득표를 baseTally에 누적하고 regionAcc 초기화
        C.forEach(k => {
          state.baseTally[k] += state.regionAcc[k];
          state.regionAcc[k] = 0;
        });

        const remaining = REGIONS.filter(r => !state.regionsDone.includes(r));

        // 개표 완료 버튼 표시
        setTimeout(() => {
          showFinishButton(remaining);
        }, 1350);
      }
    }
  }

  function showCardAnimation(picked) {
    const animArea = $('#card-animation-area');

    // 기존 애니메이션 완전히 제거
    animArea.innerHTML = '';

    // DOM 리플로우 강제 실행 (애니메이션 재시작을 위해)
    void animArea.offsetWidth;

    const cardImg = document.createElement('img');
    cardImg.className = 'card-reveal';

    // 무효표 (주머니가 비었을 때)
    if (picked === null) {
      cardImg.src = 'Resources/files/리소스/4단계_지역 개표/Invalid.png';
    }
    // 후보 E 처리
    else if (picked === 'E') {
      if (state.unify) {
        // 단일화된 경우 - Red_[color].png
        const colorMap = {
          'A': 'orange',
          'B': 'purple',
          'C': 'green',
          'D': 'white'
        };
        cardImg.src = `Resources/files/리소스/4단계_지역 개표/Red_${colorMap[state.unify]}.png`;
      } else {
        // 단일화 안된 경우 Red.png
        cardImg.src = 'Resources/files/리소스/4단계_지역 개표/Red.png';
      }
    } else {
      // A, B, C, D 후보
      const colorMap = {
        'A': 'Orange',
        'B': 'Purple',
        'C': 'Green',
        'D': 'White'
      };
      cardImg.src = `Resources/files/리소스/4단계_지역 개표/${colorMap[picked]}.png`;
    }

    // 다음 프레임에 추가하여 애니메이션 확실히 재시작
    requestAnimationFrame(() => {
      animArea.appendChild(cardImg);
    });

    // 애니메이션 후 제거
    setTimeout(() => {
      animArea.innerHTML = '';
    }, 1200);
  }

  $('#draw1').addEventListener('click', drawOnce);

  // 추가개표 시작
  function startRunoff(tiedCandidates) {
    // 추가개표 모드 활성화
    state.runoffMode = true;
    state.runoffCandidates = tiedCandidates;

    // 주머니에 남아있는 표 유지하고, 동점자들의 표만 1개씩 추가
    tiedCandidates.forEach(cand => {
      state.bagRemain[cand] += 1;
    });

    // 개표 횟수는 무제한 (동점자 표가 나올 때까지)
    state.drawsRemain = 999;

    $('#remain-draws').textContent = 'Runoff';
    $('#total-draws').textContent = 'In Progress';

    updateBagRemainDisplay();

    // 개표 버튼 활성화
    const drawBtn = $('#draw1');
    drawBtn.disabled = false;
    drawBtn.style.opacity = '1';
    isAnimating = false;

    // 애니메이션 영역 초기화
    const animArea = $('#card-animation-area');
    animArea.innerHTML = '';
  }

  // 개표 완료 버튼 표시
  function showFinishButton(remaining) {
    const animArea = $('#card-animation-area');
    animArea.innerHTML = '';

    // 개표하기 버튼 비활성화
    const drawBtn = $('#draw1');
    drawBtn.disabled = true;
    drawBtn.style.opacity = '0.3';
    drawBtn.style.pointerEvents = 'none';

    // 반투명 오버레이 생성
    const overlay = document.createElement('div');
    overlay.id = 'finish-overlay';
    overlay.style.cssText = `
      position: absolute;
      top: 25%;
      left: 3.31%;
      width: 93%;
      height: 39.4%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9;
      pointer-events: none;
      border-radius: 0;
    `;
    $('.panel-4').appendChild(overlay);

    const finishBtn = document.createElement('button');
    finishBtn.style.cssText = `
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 0;
      transition: transform 0.2s;
      pointer-events: auto;
      position: relative;
      z-index: 11;
    `;

    const finishImg = document.createElement('img');
    finishImg.src = 'Resources/files/리소스/4단계_지역 개표/Finish.png';
    finishImg.style.cssText = `
      width: 100%;
      height: 100%;
      object-fit: contain;
    `;

    finishBtn.appendChild(finishImg);

    // 오버레이 제거 함수
    function removeOverlay() {
      const existingOverlay = $('#finish-overlay');
      if (existingOverlay) {
        existingOverlay.remove();
      }
      drawBtn.style.pointerEvents = '';
    }

    finishBtn.addEventListener('click', () => {
      // 서울경기이고 남은 지역이 없을 때 동점 체크
      if (state.currentRegion === '서울경기' && remaining.length === 0) {
        const max = Math.max(...C.map(k => state.tally[k]));
        const winners = C.filter(k => state.tally[k] === max);

        if (winners.length > 1) {
          // 동점 발생
          alert('A tie has occurred. Additional vote counting will proceed.');
          removeOverlay();
          animArea.innerHTML = '';
          startRunoff(winners);
          return;
        }
      }

      removeOverlay();
      animArea.innerHTML = '';

      if (remaining.length === 0) {
        showFinalResults();
      } else {
        buildRegionButtons();
        show('#screen2');
      }
    });

    finishBtn.addEventListener('mouseenter', () => {
      finishBtn.style.transform = 'scale(1.05)';
    });

    finishBtn.addEventListener('mouseleave', () => {
      finishBtn.style.transform = 'scale(1)';
    });

    finishBtn.addEventListener('mousedown', () => {
      finishBtn.style.transform = 'scale(0.95)';
    });

    finishBtn.addEventListener('mouseup', () => {
      finishBtn.style.transform = 'scale(1.05)';
    });

    animArea.appendChild(finishBtn);
  }

  // 최종 결과
  function showFinalResults() {
    const max = Math.max(...C.map(k => state.tally[k]));
    const winners = C.filter(k => state.tally[k] === max);

    // 당선자 정보 저장
    state.winner = winners.length === 1 ? winners[0] : null;

    // 당선자에 따라 배경 이미지 변경
    const winnerBg = $('#winner-bg');
    if (winners.length === 1) {
      const colorMap = {
        'A': 'orange',
        'B': 'purple',
        'C': 'green',
        'D': 'white'
      };
      winnerBg.src = `Resources/files/리소스/5단계_당선/background_${colorMap[winners[0]]}.png`;
    } else {
      // 공동 당선인 경우 첫 번째 후보 배경 사용
      const colorMap = {
        'A': 'orange',
        'B': 'purple',
        'C': 'green',
        'D': 'white'
      };
      winnerBg.src = `Resources/files/리소스/5단계_당선/background_${colorMap[winners[0]]}.png`;
    }

    show('#screen5');
  }

  // 통계 계산 및 표시
  function displayStats() {
    const regionStatsMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats'
    };

    const logoMap = {
      'A': 'Resources/files/리소스/1단계_핵심지지층/Orange_logo.png',
      'B': 'Resources/files/리소스/1단계_핵심지지층/Purple_logo.png',
      'C': 'Resources/files/리소스/1단계_핵심지지층/Green_logo.png',
      'D': 'Resources/files/리소스/1단계_핵심지지층/White_logo.png'
    };

    // 지역별 통계
    REGIONS.forEach(region => {
      const results = state.regionResults[region] || {A:0, B:0, C:0, D:0};
      const regionData = state.regionData[region];

      // 득표순으로 정렬
      const sorted = C.map(k => {
        const votes = results[k] || 0;
        let total = regionData.support[k] || 0;

        // 단일화된 후보라면 E표(1개)도 유권자에 포함
        if (state.unify === k) {
          total += 1;
        }

        const rate = total > 0 ? (votes / total * 100) : 0;
        return {
          cand: k,
          votes: votes,
          rate: rate
        };
      }).sort((a, b) => b.votes - a.votes);

      // 투표율 계산: 개표회수 / 주머니 내부 표의 총개수
      const totalVotesDrawn = C.reduce((sum, k) => sum + (results[k] || 0), 0);
      let totalVotesInBag = C.reduce((sum, k) => sum + (regionData.support[k] || 0), 0);

      // E표(1개)도 유권자에 포함
      totalVotesInBag += 1;

      const turnout = totalVotesInBag > 0 ? (totalVotesDrawn / totalVotesInBag * 100) : 0;

      // HTML 업데이트
      const container = $(regionStatsMap[region]);
      if (container) {
        sorted.forEach((data, index) => {
          const card = container.querySelector(`.rank${index + 1}`);
          if (card) {
            card.innerHTML = `
              <img src="${logoMap[data.cand]}" class="stat-logo" alt="${data.cand}">
              <div class="stat-votes">${data.votes}</div>
              <div class="stat-rate">${data.rate.toFixed(1)}%</div>
            `;
          }
        });

        // 투표율 표시
        const turnoutEl = container.querySelector('.region-turnout');
        if (turnoutEl) {
          turnoutEl.textContent = `${turnout.toFixed(1)}%`;
        }
      }
    });

    // 전국 통계
    const nationalSorted = C.map(k => {
      // 전체 득표수 - 핵심지지층
      const votes = (state.tally[k] || 0) - (state.coreSupport[k] || 0);

      // 모든 지역 주머니 합계
      let totalBag = 0;
      REGIONS.forEach(region => {
        totalBag += state.regionData[region].support[k] || 0;
      });

      // 단일화된 후보라면 E표(지역 수만큼)도 유권자에 포함
      if (state.unify === k) {
        totalBag += REGIONS.length;
      }

      const rate = totalBag > 0 ? (votes / totalBag * 100) : 0;
      return {
        cand: k,
        votes: votes,
        rate: rate
      };
    }).sort((a, b) => b.votes - a.votes);

    // 전국 투표율 계산
    let nationalTotalDrawn = 0;
    let nationalTotalBag = 0;
    REGIONS.forEach(region => {
      const results = state.regionResults[region] || {A:0, B:0, C:0, D:0};
      const regionData = state.regionData[region];
      C.forEach(k => {
        nationalTotalDrawn += results[k] || 0;
        nationalTotalBag += regionData.support[k] || 0;
      });
    });

    // E표(지역 수만큼)도 유권자에 포함
    nationalTotalBag += REGIONS.length;

    const nationalTurnout = nationalTotalBag > 0 ? (nationalTotalDrawn / nationalTotalBag * 100) : 0;

    const nationalContainer = $('.national-stats');
    if (nationalContainer) {
      nationalSorted.forEach((data, index) => {
        const card = nationalContainer.querySelector(`.rank${index + 1}`);
        if (card) {
          card.innerHTML = `
            <img src="${logoMap[data.cand]}" class="stat-logo" alt="${data.cand}">
            <div class="stat-votes">${data.votes}</div>
            <div class="stat-rate">${data.rate.toFixed(1)}%</div>
          `;
        }
      });

      // 전국 투표율 표시
      const turnoutEl = nationalContainer.querySelector('.region-turnout');
      if (turnoutEl) {
        turnoutEl.textContent = `${nationalTurnout.toFixed(1)}%`;
      }
    }
  }

  // 통계보기 버튼
  $('#view-stats').addEventListener('click', () => {
    // 통계 페이지 배경 설정
    const statsBg = $('#stats-bg');
    const max = Math.max(...C.map(k => state.tally[k] || 0));
    const winners = C.filter(k => (state.tally[k] || 0) === max);

    const colorMap = {
      'A': 'orange',
      'B': 'purple',
      'C': 'green',
      'D': 'white'
    };

    // 당선자 결정 (득표가 없거나 모두 0이면 C(green) 기본값)
    const winner = (winners.length > 0 && max > 0) ? winners[0] : 'C';
    const color = colorMap[winner] || 'green';

    statsBg.src = `Resources/files/리소스/6단계_통계/background_${color}.png`;

    // 통계 데이터 표시
    displayStats();

    show('#screen6');
  });

  // 결과로 돌아가기 버튼 (화면6 → 화면4)
  $('#back-to-result').addEventListener('click', () => {
    show('#screen4');
    showFinishButton([]);
  });

  // ===== Scale 계산 (고정 크기 1594x1145 기준) =====
  function updateScale() {
    const baseWidth = 1594;
    const baseHeight = 1145;
    const margin = 32; // 여백

    const scaleX = (window.innerWidth - margin) / baseWidth;
    const scaleY = (window.innerHeight - margin) / baseHeight;

    // 화면에 완전히 맞추기: 가로/세로 모두 고려, 스크롤 없음
    const scale = Math.min(scaleX, scaleY, 1);

    document.documentElement.style.setProperty('--scale', scale);
  }

  window.addEventListener('resize', updateScale);
  window.addEventListener('load', updateScale);
  updateScale(); // 초기 실행

  // 초기 표시
  show('#screen1');

  // ===== 모바일 전체화면 + 가로모드 (첫 터치 시) =====
  function isMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
      || (navigator.maxTouchPoints && navigator.maxTouchPoints > 2);
  }

  if (isMobile()) {
    let fullscreenRequested = false;

    // 전체화면 진입 시 가로모드 잠금
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement && screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(() => {});
      }
    });

    const enableFullscreen = () => {
      if (fullscreenRequested) return;
      fullscreenRequested = true;

      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        elem.requestFullscreen().catch(() => {});
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }
    };

    document.addEventListener('click', enableFullscreen, { once: true });
    document.addEventListener('touchstart', enableFullscreen, { once: true });
  }

  // ===== 디버깅 헬퍼: 빨간 아이콘 크기 조정 =====
  window.redIconSize = function(percent) {
    const bagDisplay = $('#bag-remain-display');
    if (!bagDisplay) {
      console.log('❌ 개표 화면(화면4)에서 실행해주세요.');
      return;
    }
    const redIcon = bagDisplay.querySelector('img[alt="Red"]');
    if (!redIcon) {
      console.log('❌ 빨간 아이콘을 찾을 수 없습니다.');
      return;
    }
    redIcon.style.width = percent + '%';
    redIcon.style.height = percent + '%';
    console.log(`✅ 빨간 아이콘 크기: ${percent}%`);
    console.log(`💡 적용하려면 코드에서 1978-1979 라인의 70%를 ${percent}%로 변경하세요.`);
  };

  // ===== 디버깅 헬퍼: 도움말 =====
  window.도움말 = function() {
    console.log(`
╔══════════════════════════════════════════════════════════════════╗
║                    🎮 디버그 명령어 도움말                        ║
╚══════════════════════════════════════════════════════════════════╝

📌 오버레이 (화면4 개표완료 시)
────────────────────────────────────────
  오버레이테스트()                    테스트용 오버레이 표시
  오버레이조정(top, left, width, height)  위치/크기 (% 단위)
  오버레이투명도(opacity)             투명도 (0~1)
  오버레이모서리(radius)              모서리 둥글기 (px)
  오버레이현재값()                    현재 설정값 출력
  오버레이제거()                      오버레이 제거

📌 미플 트랙 (화면4 득표 트랙)
────────────────────────────────────────
  미플위치조정(간격, 시작위치)         미플 가로 위치 (%)
  미플세로조정(A, B, C, D)            미플 세로 위치 (%)
  컨테이너조정(left, bottom, width, height)  컨테이너 위치/크기 (%)
  컨테이너테두리(show)                테두리 표시 (true/false)
  테스트득표(a, b, c, d)              테스트 득표 설정

📌 통계 페이지 (화면6)
────────────────────────────────────────
  통계페이지(color)                   통계 페이지로 이동 (orange/purple/green/white)
  통계위치조정(region, top, left)      지역 박스 위치 (%)
  통계크기조정(rank1Size, rank234Size) 칸 크기 (px)
  통계칸위치(region, rank, top, left)  개별 칸 위치 (px)
  통계칸크기(region, rank, width, height)  개별 칸 크기 (px)
  통계칸드래그모드(enable)            칸 드래그 모드 (true/false)
  전국크기(rank1Size, rank234Size)    전국 칸 크기 (px)

📌 통계 지역별 단축 명령어
────────────────────────────────────────
  서울경기위치(top, left)
  강원위치(top, left)
  충청위치(top, left)
  경상위치(top, left)
  전라위치(top, left)
  전국위치(top, left)

📌 투표율 (화면6)
────────────────────────────────────────
  투표율위치(region, bottom, right)   투표율 위치 (px)
  투표율크기(region, fontSize)        투표율 글자 크기 (px)
  투표율드래그모드(enable)            드래그 모드 (true/false)

💡 지역명: '서울경기', '강원', '충청', '경상', '전라', '전국'
💡 rank: 'rank1', 'rank2', 'rank3', 'rank4'
`);
  };

  console.log('🎮 디버그 모드 활성화 - 도움말() 을 입력하세요');

  // ===== 디버깅 헬퍼: 오버레이 조정 =====
  // 브라우저 콘솔에서 사용 가능
  window.오버레이테스트 = function() {
    // 기존 오버레이 제거
    const existing = $('#finish-overlay');
    if (existing) existing.remove();

    // 테스트용 오버레이 생성
    const overlay = document.createElement('div');
    overlay.id = 'finish-overlay';
    overlay.style.cssText = `
      position: absolute;
      top: 25%;
      left: 3.31%;
      width: 93%;
      height: 39.4%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9;
      pointer-events: none;
      border-radius: 0;
    `;
    $('.panel-4').appendChild(overlay);
    console.log('✅ 오버레이 테스트 표시');
  };

  window.오버레이조정 = function(top, left, width, height) {
    const overlay = $('#finish-overlay');
    if (!overlay) {
      console.log('❌ 오버레이가 없습니다. 오버레이테스트()를 먼저 실행하세요.');
      return;
    }
    if (top !== undefined) overlay.style.top = top + '%';
    if (left !== undefined) overlay.style.left = left + '%';
    if (width !== undefined) overlay.style.width = width + '%';
    if (height !== undefined) overlay.style.height = height + '%';
    console.log(`✅ 오버레이 조정: top=${top}%, left=${left}%, width=${width}%, height=${height}%`);
  };

  window.오버레이투명도 = function(opacity) {
    const overlay = $('#finish-overlay');
    if (!overlay) {
      console.log('❌ 오버레이가 없습니다. 오버레이테스트()를 먼저 실행하세요.');
      return;
    }
    overlay.style.background = `rgba(0, 0, 0, ${opacity})`;
    console.log(`✅ 오버레이 투명도: ${opacity * 100}%`);
  };

  window.오버레이모서리 = function(radius) {
    const overlay = $('#finish-overlay');
    if (!overlay) {
      console.log('❌ 오버레이가 없습니다. 오버레이테스트()를 먼저 실행하세요.');
      return;
    }
    overlay.style.borderRadius = radius + 'px';
    console.log(`✅ 오버레이 모서리: ${radius}px`);
  };

  window.오버레이제거 = function() {
    const overlay = $('#finish-overlay');
    if (overlay) {
      overlay.remove();
      console.log('✅ 오버레이 제거됨');
    } else {
      console.log('❌ 오버레이가 없습니다.');
    }
  };

  window.오버레이현재값 = function() {
    const overlay = $('#finish-overlay');
    if (!overlay) {
      console.log('❌ 오버레이가 없습니다.');
      return;
    }
    console.log('📋 현재 오버레이 설정:');
    console.log(`  top: ${overlay.style.top || '0'}`);
    console.log(`  left: ${overlay.style.left || '0'}`);
    console.log(`  width: ${overlay.style.width || '100%'}`);
    console.log(`  height: ${overlay.style.height || '100%'}`);
    console.log(`  background: ${overlay.style.background}`);
    console.log(`  borderRadius: ${overlay.style.borderRadius || '20px'}`);
  };

  // ===== 디버깅 헬퍼: 미플 위치 조정 =====
  // 브라우저 콘솔에서 사용 가능
  window.미플위치조정 = function(간격, 시작위치) {
    window.meepleConfig = { 간격, 시작위치 };
    recompute();
    console.log(`✅ 미플 설정 변경: 간격=${간격}%, 시작위치=${시작위치}%`);
  };

  window.컨테이너조정 = function(left, bottom, width, height) {
    const container = document.querySelector('.tally-meeples-container');
    if (left !== undefined) container.style.left = left + '%';
    if (bottom !== undefined) container.style.bottom = bottom + '%';
    if (width !== undefined) container.style.width = width + '%';
    if (height !== undefined) container.style.height = height + '%';
    console.log(`✅ 컨테이너 조정: left=${left}%, bottom=${bottom}%, width=${width}%, height=${height}%`);
  };

  window.미플세로조정 = function(A, B, C, D) {
    if (A !== undefined) document.querySelector('#meeple-A').style.top = A + '%';
    if (B !== undefined) document.querySelector('#meeple-B').style.top = B + '%';
    if (C !== undefined) document.querySelector('#meeple-C').style.top = C + '%';
    if (D !== undefined) document.querySelector('#meeple-D').style.top = D + '%';
    console.log(`✅ 미플 세로 위치 조정: A=${A}%, B=${B}%, C=${C}%, D=${D}%`);
  };

  window.컨테이너테두리 = function(show = true) {
    const container = document.querySelector('.tally-meeples-container');
    container.style.border = show ? '2px dashed red' : 'none';
    console.log(show ? '✅ 컨테이너 테두리 표시' : '✅ 컨테이너 테두리 숨김');
  };

  window.테스트득표 = function(a=5, b=10, c=15, d=20) {
    state.baseTally = {A:a, B:b, C:c, D:d};
    state.regionAcc = {A:0, B:0, C:0, D:0};
    recompute();
    console.log(`✅ 테스트 득표 설정: A=${a}, B=${b}, C=${c}, D=${d}`);
  };

  // ===== 통계 위치 조정 함수 =====

  // 통계 위치 조정
  window.통계위치조정 = function(region, top, left) {
    const classMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats',
      '전국': '.national-stats'
    };

    const element = $(classMap[region]);
    if (element) {
      if (top !== undefined) element.style.top = top + '%';
      if (left !== undefined) element.style.left = left + '%';
      console.log(`✅ ${region} 위치 조정: top=${top}%, left=${left}%`);
    } else {
      console.error(`❌ 지역을 찾을 수 없습니다: ${region}`);
    }
  };

  // 개별 지역 위치 조정
  window.서울경기위치 = function(top, left) { 통계위치조정('서울경기', top, left); };
  window.강원위치 = function(top, left) { 통계위치조정('강원', top, left); };
  window.충청위치 = function(top, left) { 통계위치조정('충청', top, left); };
  window.경상위치 = function(top, left) { 통계위치조정('경상', top, left); };
  window.전라위치 = function(top, left) { 통계위치조정('전라', top, left); };
  window.전국위치 = function(top, left) { 통계위치조정('전국', top, left); };

  // 통계 칸 크기 조정
  window.통계크기조정 = function(rank1Size, rank234Size) {
    const rank1Cards = $$('.stat-card.rank1');
    const otherCards = $$('.stat-card.rank2, .stat-card.rank3, .stat-card.rank4');

    if (rank1Size !== undefined) {
      rank1Cards.forEach(card => {
        card.style.width = rank1Size + 'px';
        card.style.height = rank1Size + 'px';
      });
    }

    if (rank234Size !== undefined) {
      otherCards.forEach(card => {
        card.style.width = rank234Size + 'px';
        card.style.height = rank234Size + 'px';
      });
    }

    console.log(`✅ 통계 칸 크기 조정: rank1=${rank1Size}px, rank2-4=${rank234Size}px`);
  };

  // 박스 내 개별 칸 위치 조정 (px 단위)
  window.통계칸위치 = function(region, rank, top, left) {
    const classMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats',
      '전국': '.national-stats'
    };

    const container = $(classMap[region]);
    if (container) {
      const card = container.querySelector(`.${rank}`);
      if (card) {
        if (top !== undefined) card.style.top = top + 'px';
        if (left !== undefined) card.style.left = left + 'px';
        console.log(`✅ ${region} ${rank} 위치: top=${top}px, left=${left}px`);
      } else {
        console.error(`❌ ${rank}를 찾을 수 없습니다`);
      }
    } else {
      console.error(`❌ ${region}를 찾을 수 없습니다`);
    }
  };

  // 박스 내 개별 칸 크기 조정
  window.통계칸크기 = function(region, rank, width, height) {
    const classMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats',
      '전국': '.national-stats'
    };

    const container = $(classMap[region]);
    if (container) {
      const card = container.querySelector(`.${rank}`);
      if (card) {
        if (width !== undefined) card.style.width = width + 'px';
        if (height !== undefined) card.style.height = height + 'px';
        console.log(`✅ ${region} ${rank} 크기: ${width}x${height}px`);
      }
    }
  };

  // 전국 박스 전용 크기 조정
  window.전국크기 = function(rank1Size, rank234Size) {
    const national = $('.national-stats');
    if (national) {
      if (rank1Size !== undefined) {
        const rank1 = national.querySelector('.rank1');
        if (rank1) {
          rank1.style.width = rank1Size + 'px';
          rank1.style.height = rank1Size + 'px';
        }
      }

      if (rank234Size !== undefined) {
        ['rank2', 'rank3', 'rank4'].forEach(rank => {
          const card = national.querySelector(`.${rank}`);
          if (card) {
            card.style.width = rank234Size + 'px';
            card.style.height = rank234Size + 'px';
          }
        });
      }

      console.log(`✅ 전국 크기: rank1=${rank1Size}px, rank2-4=${rank234Size}px`);
    }
  };

  // 칸 내부 드래그 모드 (박스 내 칸들을 드래그)
  window.통계칸드래그모드 = function(enable = true) {
    const allCards = $$('.stat-card');

    if (enable) {
      allCards.forEach(card => {
        card.style.border = '1px solid blue';
        card.style.cursor = 'move';

        const mouseDown = (e) => {
          dragState.isDragging = true;
          dragState.element = card;
          dragState.startX = e.clientX;
          dragState.startY = e.clientY;

          const computedLeft = parseFloat(card.style.left) || 0;
          const computedTop = parseFloat(card.style.top) || 0;
          dragState.startLeft = computedLeft;
          dragState.startTop = computedTop;

          e.preventDefault();
          e.stopPropagation();
        };

        card._cardDragMouseDown = mouseDown;
        card.addEventListener('mousedown', mouseDown);
      });

      // 마우스업 이벤트 수정 (픽셀 단위로)
      document._cardDragMouseUp = () => {
        if (dragState.isDragging && dragState.element && dragState.element.classList.contains('stat-card')) {
          dragState.isDragging = false;

          const element = dragState.element;
          const left = parseFloat(element.style.left);
          const top = parseFloat(element.style.top);

          // 지역과 rank 찾기
          const parent = element.parentElement;
          const classMap = {
            'seoul-stats': '서울경기',
            'gangwon-stats': '강원',
            'chungcheong-stats': '충청',
            'gyeongsang-stats': '경상',
            'jeolla-stats': '전라',
            'national-stats': '전국'
          };

          let regionName = '';
          for (const [className, name] of Object.entries(classMap)) {
            if (parent.classList.contains(className)) {
              regionName = name;
              break;
            }
          }

          let rankName = '';
          if (element.classList.contains('rank1')) rankName = 'rank1';
          else if (element.classList.contains('rank2')) rankName = 'rank2';
          else if (element.classList.contains('rank3')) rankName = 'rank3';
          else if (element.classList.contains('rank4')) rankName = 'rank4';

          console.log(`✅ ${regionName} ${rankName}: 통계칸위치("${regionName}", "${rankName}", ${top.toFixed(0)}, ${left.toFixed(0)})`);

          dragState.element = null;
        }
      };

      document.addEventListener('mouseup', document._cardDragMouseUp);

      console.log('✅ 칸 드래그 모드 활성화 - 각 칸을 드래그하여 위치 조정하세요');
    } else {
      allCards.forEach(card => {
        card.style.border = 'none';
        card.style.cursor = 'default';

        if (card._cardDragMouseDown) {
          card.removeEventListener('mousedown', card._cardDragMouseDown);
          delete card._cardDragMouseDown;
        }
      });

      if (document._cardDragMouseUp) {
        document.removeEventListener('mouseup', document._cardDragMouseUp);
        delete document._cardDragMouseUp;
      }

      console.log('✅ 칸 드래그 모드 비활성화');
    }
  };

  // 통계 페이지로 바로 이동 (테스트용)
  window.통계페이지 = function(color) {
    const statsBg = $('#stats-bg');

    // 색상이 지정되지 않으면 현재 득표 기반으로 자동 계산
    if (!color) {
      const max = Math.max(...C.map(k => state.tally[k] || 0));
      const winners = C.filter(k => (state.tally[k] || 0) === max);

      const colorMap = {
        'A': 'orange',
        'B': 'purple',
        'C': 'green',
        'D': 'white'
      };

      // 당선자 결정 (득표가 없거나 모두 0이면 C(green) 기본값)
      const winner = (winners.length > 0 && max > 0) ? winners[0] : 'C';
      color = colorMap[winner] || 'green';
    }

    statsBg.src = `Resources/files/리소스/6단계_통계/background_${color}.png`;

    show('#screen6');
    displayStats();
    console.log(`✅ 통계 페이지로 이동했습니다. (배경: ${color})`);
  };

  // 투표율 위치 조정 함수
  window.투표율위치 = function(region, bottom, right) {
    const regionMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats',
      '전국': '.national-stats'
    };

    const selector = regionMap[region];
    if (!selector) {
      console.log(`❌ 알 수 없는 지역: ${region}`);
      return;
    }

    const container = $(selector);
    const turnoutEl = container?.querySelector('.region-turnout');
    if (turnoutEl) {
      turnoutEl.style.bottom = `${bottom}px`;
      turnoutEl.style.right = `${right}px`;
      console.log(`✅ ${region} 투표율 위치: 투표율위치("${region}", ${bottom}, ${right})`);
    }
  };

  // 투표율 크기 조정 함수
  window.투표율크기 = function(region, fontSize) {
    const regionMap = {
      '서울경기': '.seoul-stats',
      '강원': '.gangwon-stats',
      '충청': '.chungcheong-stats',
      '경상': '.gyeongsang-stats',
      '전라': '.jeolla-stats',
      '전국': '.national-stats'
    };

    const selector = regionMap[region];
    if (!selector) {
      console.log(`❌ 알 수 없는 지역: ${region}`);
      return;
    }

    const container = $(selector);
    const turnoutEl = container?.querySelector('.region-turnout');
    if (turnoutEl) {
      turnoutEl.style.fontSize = `${fontSize}px`;
      console.log(`✅ ${region} 투표율 크기: 투표율크기("${region}", ${fontSize})`);
    }
  };

  // 투표율 드래그 모드
  window.투표율드래그모드 = function(enable = true) {
    const regionNames = ['서울경기', '강원', '충청', '경상', '전라', '전국'];
    const regionClasses = ['.seoul-stats', '.gangwon-stats', '.chungcheong-stats',
                          '.gyeongsang-stats', '.jeolla-stats', '.national-stats'];

    if (enable) {
      regionClasses.forEach((className, index) => {
        const container = $(className);
        const turnoutEl = container?.querySelector('.region-turnout');

        if (turnoutEl) {
          turnoutEl.style.border = '2px dashed cyan';
          turnoutEl.style.cursor = 'move';

          const regionName = regionNames[index];
          let dragState = {
            isDragging: false,
            startX: 0,
            startY: 0,
            startBottom: 0,
            startRight: 0
          };

          const mouseDown = (e) => {
            dragState.isDragging = true;
            dragState.startX = e.clientX;
            dragState.startY = e.clientY;

            const currentBottom = parseInt(turnoutEl.style.bottom) || 5;
            const currentRight = parseInt(turnoutEl.style.right) || 10;
            dragState.startBottom = currentBottom;
            dragState.startRight = currentRight;

            e.preventDefault();
          };

          const mouseMove = (e) => {
            if (!dragState.isDragging) return;

            const deltaX = e.clientX - dragState.startX;
            const deltaY = e.clientY - dragState.startY;

            const newRight = dragState.startRight - deltaX;
            const newBottom = dragState.startBottom + deltaY;

            turnoutEl.style.bottom = `${newBottom}px`;
            turnoutEl.style.right = `${newRight}px`;
          };

          const mouseUp = () => {
            if (dragState.isDragging) {
              const bottom = parseInt(turnoutEl.style.bottom) || 5;
              const right = parseInt(turnoutEl.style.right) || 10;
              console.log(`✅ ${regionName} 투표율: 투표율위치("${regionName}", ${bottom}, ${right})`);
              dragState.isDragging = false;
            }
          };

          turnoutEl.addEventListener('mousedown', mouseDown);
          document.addEventListener('mousemove', mouseMove);
          document.addEventListener('mouseup', mouseUp);

          // 이벤트 제거를 위해 저장
          turnoutEl._turnoutDragHandlers = { mouseDown, mouseMove, mouseUp };
        }
      });

      console.log('✅ 투표율 드래그 모드 활성화 - 투표율을 드래그하여 위치 조정하세요');
    } else {
      regionClasses.forEach(className => {
        const container = $(className);
        const turnoutEl = container?.querySelector('.region-turnout');

        if (turnoutEl && turnoutEl._turnoutDragHandlers) {
          turnoutEl.style.border = 'none';
          turnoutEl.style.cursor = 'default';

          const handlers = turnoutEl._turnoutDragHandlers;
          turnoutEl.removeEventListener('mousedown', handlers.mouseDown);
          document.removeEventListener('mousemove', handlers.mouseMove);
          document.removeEventListener('mouseup', handlers.mouseUp);

          delete turnoutEl._turnoutDragHandlers;
        }
      });

      console.log('✅ 투표율 드래그 모드 비활성화');
    }
  };

  // 드래그 앤 드롭 기능
  let dragState = {
    isDragging: false,
    element: null,
    startX: 0,
    startY: 0,
    startLeft: 0,
    startTop: 0
  };

  function enableDragForElement(element, regionName) {
    element.style.border = '2px dashed red';
    element.style.cursor = 'move';

    const mouseDown = (e) => {
      dragState.isDragging = true;
      dragState.element = element;
      dragState.startX = e.clientX;
      dragState.startY = e.clientY;

      const rect = element.getBoundingClientRect();
      const parent = element.offsetParent.getBoundingClientRect();
      dragState.startLeft = (rect.left - parent.left) / parent.width * 100;
      dragState.startTop = (rect.top - parent.top) / parent.height * 100;

      e.preventDefault();
    };

    element._dragMouseDown = mouseDown;
    element.addEventListener('mousedown', mouseDown);
  }

  function disableDragForElement(element) {
    element.style.border = 'none';
    element.style.cursor = 'default';

    if (element._dragMouseDown) {
      element.removeEventListener('mousedown', element._dragMouseDown);
      delete element._dragMouseDown;
    }
  }

  document.addEventListener('mousemove', (e) => {
    if (!dragState.isDragging || !dragState.element) return;

    const deltaX = e.clientX - dragState.startX;
    const deltaY = e.clientY - dragState.startY;

    // stat-card인 경우 픽셀 단위, region-stats인 경우 퍼센트 단위
    if (dragState.element.classList.contains('stat-card')) {
      // 픽셀 단위로 이동
      const newLeft = dragState.startLeft + deltaX;
      const newTop = dragState.startTop + deltaY;

      dragState.element.style.left = newLeft + 'px';
      dragState.element.style.top = newTop + 'px';
    } else {
      // 퍼센트 단위로 이동
      const parent = dragState.element.offsetParent.getBoundingClientRect();
      const newLeft = dragState.startLeft + (deltaX / parent.width * 100);
      const newTop = dragState.startTop + (deltaY / parent.height * 100);

      dragState.element.style.left = newLeft + '%';
      dragState.element.style.top = newTop + '%';
    }
  });

  document.addEventListener('mouseup', () => {
    if (dragState.isDragging && dragState.element) {
      // stat-card는 통계칸드래그모드의 별도 핸들러에서 처리
      if (dragState.element.classList.contains('stat-card')) {
        return;
      }

      dragState.isDragging = false;

      const element = dragState.element;
      const left = parseFloat(element.style.left);
      const top = parseFloat(element.style.top);

      // 지역명 찾기
      const classMap = {
        'seoul-stats': '서울경기',
        'gangwon-stats': '강원',
        'chungcheong-stats': '충청',
        'gyeongsang-stats': '경상',
        'jeolla-stats': '전라',
        'national-stats': '전국'
      };

      let regionName = '';
      for (const [className, name] of Object.entries(classMap)) {
        if (element.classList.contains(className)) {
          regionName = name;
          break;
        }
      }

      console.log(`✅ ${regionName} 위치: ${regionName}위치(${top.toFixed(1)}, ${left.toFixed(1)})`);

      dragState.element = null;
    }
  });

  window.통계드래그모드 = function(enable = true) {
    const statsElements = [
      { el: $('.seoul-stats'), name: '서울경기' },
      { el: $('.gangwon-stats'), name: '강원' },
      { el: $('.chungcheong-stats'), name: '충청' },
      { el: $('.gyeongsang-stats'), name: '경상' },
      { el: $('.jeolla-stats'), name: '전라' },
      { el: $('.national-stats'), name: '전국' }
    ];

    if (enable) {
      statsElements.forEach(({ el, name }) => {
        if (el) enableDragForElement(el, name);
      });
      console.log('✅ 드래그 모드 활성화 - 통계 박스를 드래그하여 위치 조정하세요');
      console.log('   드래그 완료 시 콘솔에 좌표가 출력됩니다');
    } else {
      statsElements.forEach(({ el }) => {
        if (el) disableDragForElement(el);
      });
      console.log('✅ 드래그 모드 비활성화');
    }
  };

  // ===== 추가개표 테스트 함수 =====

  // 테스트: 서울경기 개표 화면으로 바로 가기
  window.서울경기개표 = function() {
    // 모든 지역 완료 처리 (서울경기 제외)
    const otherRegions = REGIONS.filter(r => r !== '서울경기');
    state.regionsDone = [...otherRegions];
    state.currentRegion = '서울경기';

    // 서울경기 데이터 설정 (간단한 값)
    state.regionData['서울경기'] = {
      interest: 11,
      support: {A:1, B:1, C:1, D:1}
    };

    // 화면4로 이동
    state.bagRemain = { A:1, B:1, C:1, D:1, E:1 };
    state.drawsRemain = 11;

    const regionFile = REGION_MAP['서울경기'];
    $('#region-box').src = `Resources/files/리소스/4단계_지역 개표/${regionFile}_Box.png`;
    $('#remain-draws').textContent = state.drawsRemain;
    $('#total-draws').textContent = state.drawsRemain;

    isAnimating = false;
    const drawBtn = $('#draw1');
    drawBtn.disabled = false;
    drawBtn.style.opacity = '1';

    updateBagRemainDisplay();
    recompute();
    show('#screen4');

    console.log('✅ 서울경기 개표 화면으로 이동했습니다.');
    console.log('💡 동점만들기(10, 10, 5, 5)를 실행하여 A, B 후보를 동점으로 만들 수 있습니다.');
  };

  // 테스트: 동점 만들기
  window.동점만들기 = function(a=10, b=10, c=5, d=5) {
    state.baseTally = {A:a, B:b, C:c, D:d};
    state.regionAcc = {A:0, B:0, C:0, D:0};
    recompute();
    console.log(`✅ 득표 설정: A=${a}, B=${b}, C=${c}, D=${d}`);
  };

  // 테스트: 개표 즉시 완료 (남은 횟수를 0으로)
  window.개표완료 = function() {
    state.drawsRemain = 0;
    $('#remain-draws').textContent = 0;

    if (!state.regionsDone.includes(state.currentRegion)) {
      state.regionsDone.push(state.currentRegion);
    }

    C.forEach(k => {
      state.baseTally[k] += state.regionAcc[k];
      state.regionAcc[k] = 0;
    });

    const remaining = REGIONS.filter(r => !state.regionsDone.includes(r));

    setTimeout(() => {
      showFinishButton(remaining);
    }, 100);

    console.log('✅ 개표를 즉시 완료했습니다. 개표완료 버튼을 클릭하세요.');
  };

  // 테스트: 추가개표 직접 시작
  window.추가개표테스트 = function(candidates = ['A', 'B']) {
    if (!state.currentRegion) {
      console.error('❌ 개표 화면이 아닙니다. 서울경기개표()를 먼저 실행하세요.');
      return;
    }

    startRunoff(candidates);
    console.log(`✅ 추가개표 시작: ${candidates.join(', ')} 후보`);
  };

  console.log('%c디버깅 도구 로드됨!', 'color: green; font-size: 16px; font-weight: bold;');
  console.log('\n=== 미플 위치 조정 ===');
  console.log('  미플위치조정(간격, 시작위치) - 현재: 미플위치조정(3.3, 1.5)');
  console.log('  컨테이너조정(left, bottom, width, height) - 현재: 컨테이너조정(6, 7.5, 88, 32)');
  console.log('  미플세로조정(A, B, C, D) - 현재: 미플세로조정(22, 39, 56, 73)');
  console.log('  컨테이너테두리(true/false) - 예: 컨테이너테두리(true)');
  console.log('  테스트득표(a, b, c, d) - 예: 테스트득표(8, 12, 16, 20)');
  console.log('\n=== 통계 위치 조정 ===');
  console.log('  통계위치조정(지역명, top, left) - 예: 통계위치조정("서울경기", 23.5, 7)');
  console.log('  서울경기위치(top, left) - 현재: 서울경기위치(23.5, 7)');
  console.log('  강원위치(top, left) - 현재: 강원위치(23.5, 60)');
  console.log('  충청위치(top, left) - 현재: 충청위치(43.5, 14)');
  console.log('  경상위치(top, left) - 현재: 경상위치(43.5, 74)');
  console.log('  전라위치(top, left) - 현재: 전라위치(65.5, 6)');
  console.log('  전국위치(top, left) - 현재: 전국위치(63, 55)');
  console.log('  통계크기조정(rank1크기, rank234크기) - 현재: 통계크기조정(110, 70)');
  console.log('  통계페이지(색상) - 통계 페이지로 바로 이동 (예: 통계페이지("green"))');
  console.log('  통계드래그모드(true/false) - 박스 위치 드래그 조정');
  console.log('  통계칸드래그모드(true/false) - 박스 내 칸들 드래그 조정');
  console.log('  통계칸위치(지역, rank, top, left) - 예: 통계칸위치("서울경기", "rank1", 0, 0)');
  console.log('  통계칸크기(지역, rank, width, height) - 예: 통계칸크기("서울경기", "rank1", 120, 120)');
  console.log('  전국크기(rank1크기, rank234크기) - 전국 박스 크기 조정 (예: 전국크기(150, 90))');
  console.log('\n=== 추가개표 테스트 ===');
  console.log('  서울경기개표() - 서울경기 개표 화면으로 바로 이동');
  console.log('  동점만들기(a, b, c, d) - 득표수 설정 (기본값: 10, 10, 5, 5)');
  console.log('  개표완료() - 현재 지역 개표를 즉시 완료');
  console.log('  추가개표테스트([후보배열]) - 추가개표 직접 시작 (예: 추가개표테스트(["A","B"])');
  console.log('\n💡 빠른 테스트: 서울경기개표() → 동점만들기() → 개표완료()');
})();
</script>

</body>
</html>
